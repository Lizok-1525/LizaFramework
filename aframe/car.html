<!DOCTYPE html>
<html>

<head>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <script
        src="https://unpkg.com/aframe-environment-component@1.3.x/dist/aframe-environment-component.min.js"></script>
</head>

<body>
    <a-scene>
        <a-assets>
            <img id="boxTexture" src="https://i.imgur.com/mYmmbrp.jpg">
            <img id="skyTexture" src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/sechelt.jpg">
            <a-asset-item id="testbed"
                src="https://cdn.aframe.io/examples/post-processing/fancy-car.glb"></a-asset-item>
        </a-assets>

        <a-entity id="car" position="0 0 -2" car-controls>
            <a-entity gltf-model="#testbed" position="0 0 0" scale="2 2 2" shadow></a-entity>
        </a-entity>

        <a-box src="#boxTexture" position="0 2 -9" rotation="0 45 45" scale="1.5 1.5 1.5"
            animation__position="property: object3D.position.y; to: 2.2; dir: alternate; dur: 2000; loop: true"
            animation__mouseenter="property: scale; to: 2 2 2; dur: 300; startEvents: mouseenter"
            animation__mouseleave="property: scale; to: 2 2 2; dur: 300; startEvents: mouseleave"
            animation__click="property: rotation; from: 0 45 45; to: 0 405 45; dur: 1000; startEvents: click">
        </a-box>

        <a-sky src="#skyTexture"></a-sky>

        <a-entity environment="preset: forest; dressingAmount: 500"></a-entity>

        <a-camera position="0 2 5" look-controls wasd-controls>
            <a-cursor color="#FAFAFA"></a-cursor>
        </a-camera>

        <script>
            AFRAME.registerComponent('car-controls', {
                schema: {
                    speed: { type: 'number', default: 0.05 },
                    rotationSpeed: { type: 'number', default: 2.0 }
                },

                init: function () {
                    this.direction = new THREE.Vector3();
                    this.rotation = new THREE.Euler(0, 0, 0, 'YXZ');
                    window.addEventListener('keydown', (e) => {
                        const car = this.el.object3D;
                        switch (e.key) {
                            case 'ArrowUp':
                            case 'w':
                                this.direction.z = -1;
                                break;
                            case 'ArrowDown':
                            case 's':
                                this.direction.z = 1;
                                break;
                            case 'ArrowLeft':
                            case 'a':
                                this.direction.x = -1;
                                break;
                            case 'ArrowRight':
                            case 'd':
                                this.direction.x = 1;
                                break;
                        }
                    });

                    window.addEventListener('keyup', (e) => {
                        switch (e.key) {
                            case 'ArrowUp':
                            case 'w':
                            case 'ArrowDown':
                            case 's':
                                this.direction.z = 0;
                                break;
                            case 'ArrowLeft':
                            case 'a':
                            case 'ArrowRight':
                            case 'd':
                                this.direction.x = 0;
                                break;
                        }
                    });
                },

                tick: function (time, deltaTime) {
                    const car = this.el.object3D;
                    this.direction.normalize();
                    const moveVector = new THREE.Vector3();
                    moveVector.copy(this.direction).applyQuaternion(car.quaternion).multiplyScalar(this.data.speed);
                    car.position.add(moveVector);

                    //rotation
                    if (this.direction.x !== 0) {
                        car.rotation.y += this.direction.x * this.data.rotationSpeed * deltaTime / 1000;
                    }

                }
            });
        </script>
    </a-scene>
</body>

</html>